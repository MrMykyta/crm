/* ChatPage.module.css */
/* Chat layout styles: sidebar, room list, header, messages, composer, and overlays. */
/* Keep spacing and sizes here consistent so UI stays Telegram-like without layout jumps. */
/* ===== ROOT LAYOUT ===== */

.wrap {
  position: relative;
  display: flex;
  gap: 12px;
  height: calc(97vh - var(--topbar-h) - 2 * var(--space-3));
  margin: var(--space-3);
  border-radius: var(--radius-lg);
  isolation: isolate;
  /* Local chat UI tokens (flagship redesign). */
  --chat-left-width: 320px;
  --chat-right-width: 320px;
  --chat-surface-page: var(--surface-0);
  --chat-surface-sidebar: var(--surface-1);
  --chat-surface-chat: var(--surface-2);
  --chat-surface-overlay: var(--surface-3);
  --chat-surface-modal: var(--surface-3);
  --chat-border: rgba(255, 255, 255, 0.12);
  --chat-border-strong: rgba(255, 255, 255, 0.2);
  --chat-text-1: var(--text-1);
  --chat-text-2: var(--text-2);
  --chat-text-3: var(--text-3);
  --chat-accent: var(--accent);
  --chat-accent-2: var(--accent-2);
  --chat-hover: var(--glass);
  --chat-radius: var(--radius-md);
  --chat-radius-sm: var(--radius-sm);
  --chat-bubble-radius: 16px;
  --chat-bubble-stack-radius: 12px;
  --chat-bubble-other: rgba(255, 255, 255, 0.08);
  --chat-bubble-mine: linear-gradient(
      135deg,
      rgba(109, 125, 255, 0.3),
      rgba(167, 139, 250, 0.22)
    );
  --chat-shadow-1: var(--shadow-1);
  --chat-shadow-2: 0 26px 70px rgba(0, 0, 0, 0.45);
  --chat-ease: cubic-bezier(0.16, 1, 0.3, 1);
  --chat-hover-tr: 140ms var(--chat-ease);
  --chat-open-tr: 200ms var(--chat-ease);
  /* Override base tokens inside chat scope for cohesive theming. */
  --text: var(--chat-text-1);
  --muted: var(--chat-text-2);
  --text-1: var(--chat-text-1);
  --text-2: var(--chat-text-2);
  --text-3: var(--chat-text-3);
  --border-1: var(--chat-border);
  --border-2: var(--chat-border);
  --surface-1: var(--chat-surface-sidebar);
  --surface-2: var(--chat-surface-chat);
  --surface-3: var(--chat-surface-overlay);
  --card-bg: color-mix(in srgb, var(--chat-surface-chat) 96%, transparent);
  --card-brd: rgba(255, 255, 255, 0.14);
  --primary-start: var(--chat-accent);
  --primary-end: var(--chat-accent-2);
  font-family: "Manrope", "Satoshi", "SF Pro Text", system-ui, sans-serif;
  background: transparent;
  background-image: none;
  background-blend-mode: normal;
  box-shadow: none;
  border: 1px solid transparent;
  overflow: hidden;
}

/* ===== SIDEBAR ===== */

.sidebar {
  width: clamp(280px, 24vw, 360px);
  min-width: 280px;
  max-width: 380px;
  flex: 0 0 clamp(280px, 24vw, 360px);
  display: flex;
  flex-direction: column;
  background: transparent;
  border-right: none;
  color: var(--chat-text-1);
  box-shadow: none;
  position: relative;
  z-index: 2;
}

/* HEADER (Чаты + иконка) */

.sidebarHeader {
  padding: var(--space-4) var(--space-3) var(--space-2);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.sidebarTitle {
  font-size: 17px;
  font-weight: 700;
  letter-spacing: 0.01em;
}

.sidebarHeaderRight {
  position: relative;
  display: flex;
  align-items: center;
}

/* кнопка "новый чат" */

.newChatBtn {
  width: 34px;
  height: 34px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.14);
  cursor: pointer;
  transition: background var(--chat-hover-tr), border-color var(--chat-hover-tr),
    transform var(--chat-hover-tr);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);
  padding: 0;
}

.newChatBtnIcon {
  color: var(--chat-text-1);
}

.newChatBtn:hover {
  background: rgba(255, 255, 255, 0.12);
  border-color: color-mix(in srgb, var(--accent) 55%, transparent);
  transform: translateY(-1px);
}

.newChatBtnActive {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(109, 125, 255, 0.45);
  box-shadow: 0 0 0 1px rgba(109, 125, 255, 0.35),
    inset 0 1px 0 rgba(255, 255, 255, 0.18);
}

/* DROPDOWN */

.newChatMenu {
  position: absolute;
  left: 0;
  top: calc(100% + 8px);
  min-width: 230px;
  background: var(--chat-surface-page);
  border: 1px solid var(--card-brd);
  border-radius: 16px;
  box-shadow: var(--shadow);
  -webkit-backdrop-filter: blur(var(--glass-blur));
  backdrop-filter: blur(var(--glass-blur));
  padding: 8px;
  z-index: 2000;
}

.newChatItem {
  width: 100%;
  padding: 10px 14px;
  border: none;
  background: transparent;
  color: var(--chat-text-1);
  font-size: 13px;
  display: flex;
  align-items: center;
  gap: 10px;
  border-radius: 12px;
  cursor: pointer;
  transition: background var(--chat-hover-tr), transform var(--chat-hover-tr);
}

.newChatItem:first-child {
  margin-bottom: 2px;
}

.newChatItem:last-child {
  margin-top: 2px;
}

.newChatItem:hover {
  background: rgba(255, 255, 255, 0.06);
  transform: translateY(-1px);
}

.roomTitleRow {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.roomUnreadBadge {
  min-width: 20px;
  padding: 2px 8px;
  border-radius: 999px;
  font-size: var(--fs-md);
  line-height: 1.2;
  text-align: center;
  background: var(--danger, #ff4d4f);
  color: #000;
  font-weight: 600;
  flex-shrink: 0;
}

/* ===== SEARCH ===== */

.headerSearchWrap {
  padding: 0 var(--space-3) var(--space-3);
  border-bottom: 1px solid
    color-mix(in srgb, var(--chat-border) 70%, transparent);
}

.searchInputWrap {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: 8px 12px;
  min-height: 36px;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.12);
  background: rgba(255, 255, 255, 0.06);
  transition: border-color var(--chat-hover-tr), background var(--chat-hover-tr),
    box-shadow var(--chat-hover-tr);
}

.searchIcon {
  color: var(--chat-text-3);
  flex-shrink: 0;
}

.searchInputHeader {
  width: 100%;
  border: none;
  background: transparent;
  font-size: 13px;
  color: var(--chat-text-1);
  outline: none;
  transition: color var(--chat-hover-tr);
}

.searchInputHeader::placeholder {
  color: var(--chat-text-3);
}

.searchInputWrap:focus-within {
  border-color: color-mix(in srgb, var(--accent) 60%, transparent);
  background: rgba(255, 255, 255, 0.1);
  box-shadow: 0 0 0 2px var(--focus);
}

/* ===== ROOMS LIST ===== */

.roomsList {
  flex: 1;
  overflow-y: auto;
  padding: 8px 10px 14px;
}

.roomsEmpty {
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: var(--space-3);
  font-size: 12px;
  color: var(--chat-text-2);
}

.roomsEmptyIcon {
  color: var(--chat-text-3);
}

.roomsEmptyTitle {
  font-size: 14px;
  font-weight: 600;
  color: var(--chat-text-1);
}

.roomsEmptySubtitle {
  font-size: 12px;
  color: var(--chat-text-2);
}

.room,
.roomActive {
  position: relative;
  padding: 12px 14px;
  border-radius: 14px;
  cursor: pointer;
  margin-bottom: 6px;
  background: rgba(255, 255, 255, 0.02);
  border: 1px solid rgba(255, 255, 255, 0.08);
  transition: background var(--chat-hover-tr), border-color var(--chat-hover-tr),
    transform var(--chat-hover-tr), box-shadow var(--chat-hover-tr);

  display: grid;
  grid-template-columns: auto 1fr auto;
  grid-template-rows: auto auto;
  align-items: center;
  gap: 2px 12px;
  min-height: 70px;
}

.roomUnread {
  min-width: 20px;
  padding: 0 7px;
  height: 20px;
  border-radius: 999px;
  background: rgba(109, 125, 255, 0.28);
  color: var(--text-1);
  font-size: 11px;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);
}

.roomAvatar {
  width: 40px;
  height: 40px;
  border-radius: 14px;
  background: radial-gradient(
      14px 14px at 30% 30%,
      rgba(255, 255, 255, 0.7),
      transparent 60%
    ),
    linear-gradient(135deg, rgba(109, 125, 255, 0.55), rgba(167, 139, 250, 0.45));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  font-weight: 700;
  color: #ffffff;
  flex-shrink: 0;
  overflow: hidden;
  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.25),
    inset 0 1px 0 rgba(255, 255, 255, 0.4);
  grid-row: 1 / span 2;
}

.roomAvatarImg {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.roomText {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  grid-column: 2;
}

.roomMeta {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 6px;
  margin-left: auto;
  grid-column: 3;
  grid-row: 1 / span 2;
}

.roomTime {
  font-size: 11px;
  color: var(--chat-text-3);
  white-space: nowrap;
}

.room:hover {
  background: rgba(255, 255, 255, 0.08);
  border-color: rgba(255, 255, 255, 0.16);
  transform: translateY(-1px);
  box-shadow: 0 14px 32px rgba(0, 0, 0, 0.28),
    inset 0 1px 0 rgba(255, 255, 255, 0.14);
}

.roomActive {
  background: rgba(255, 255, 255, 0.03);
  border-color: rgba(109, 125, 255, 0.35);
  box-shadow: 0 0 0 1px rgba(109, 125, 255, 0.35),
    0 16px 40px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.18);
}

.roomActive::before {
  content: "";
  position: absolute;
  left: 8px;
  top: 10px;
  bottom: 10px;
  width: 2px;
  border-radius: 999px;
  background: var(--accent);
}

.roomTitle {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 2px;
}

.roomPreview {
  font-size: 12px;
  color: var(--chat-text-2);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ===== MAIN CHAT WINDOW ===== */

.window {
  position: relative;
  flex: 1;
  display: flex;
  flex-direction: row;
  --chat-header-h: 64px;
  margin-left: 0;
  border-left: 1px solid color-mix(in srgb, var(--sidebar-brd) 70%, transparent);
  background: transparent;
  color: var(--chat-text-1);
  min-width: 0;
}

.chatMain {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  position: relative;
  z-index: 1;
  background: color-mix(in srgb, var(--topbar-bg) 88%, #000 12%);
  border: 1px solid var(--topbar-brd);
  border-radius: 20px;
  box-shadow: var(--shadow),
    inset 0 1px 0 rgba(255, 255, 255, 0.08),
    inset 0 -1px 0 rgba(0, 0, 0, 0.25);
  overflow: hidden;
}

.chatMainSwap {
  animation: chatMainSwap 180ms cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes chatMainSwap {
  from {
    opacity: 0;
    transform: translateY(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.chatMain::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    linear-gradient(180deg, rgba(0, 0, 0, 0.28) 0%, transparent 24%),
    radial-gradient(120% 90% at 50% 50%, transparent 58%, rgba(0, 0, 0, 0.32) 100%);
  pointer-events: none;
  mix-blend-mode: normal;
  z-index: 0;
}

.chatMain > * {
  position: relative;
  z-index: 1;
}

.chatSide {
  position: relative;
  flex: 0 0 0;
  width: 0;
  overflow: hidden;
  transition: width var(--chat-open-tr), flex-basis var(--chat-open-tr);
  background: transparent;
  border-left: 1px solid transparent;
}

.chatSideOpen {
  flex: 0 0 var(--chat-right-width);
  width: var(--chat-right-width);
  border-left: 1px solid var(--chat-border);
}

.empty {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--fs-md);
  color: var(--muted);
  position: relative;
  background: color-mix(in srgb, var(--topbar-bg) 88%, #000 12%);
  border: 1px solid var(--topbar-brd);
  border-radius: 20px;
  box-shadow: var(--shadow),
    inset 0 1px 0 rgba(255, 255, 255, 0.08),
    inset 0 -1px 0 rgba(0, 0, 0, 0.25);
  overflow: hidden;
}

.empty::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    linear-gradient(180deg, rgba(0, 0, 0, 0.28) 0%, transparent 24%),
    radial-gradient(120% 90% at 50% 50%, transparent 58%, rgba(0, 0, 0, 0.32) 100%);
  pointer-events: none;
}

.empty > * {
  position: relative;
  z-index: 1;
}

/* ===== CHAT HEADER ===== */

.chatHeader {
  height: var(--chat-header-h);
  padding: 0 var(--space-4);
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  background: transparent;
  box-shadow: none;
}

.chatHeaderMain {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  margin: 0 auto;
  text-align: center;
}

.chatHeaderMainClickable {
  cursor: pointer;
}

.chatHeaderMainClickable:hover {
  background: rgba(255, 255, 255, 0.04);
  border-radius: var(--radius-md);
  padding: 6px 8px;
  margin: -6px -8px;
}

.chatHeaderMainClickable:hover .chatTitle {
  color: var(--chat-text-1);
}

.chatAvatar {
  width: 40px;
  height: 40px;
  border-radius: 14px;
  background: linear-gradient(135deg, var(--chat-accent), var(--chat-accent-2));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  font-weight: 700;
  color: #fff;
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08);
}

.chatHeaderTexts {
  display: flex;
  flex-direction: column;
  min-width: 0;
  align-items: center;
  text-align: center;
  gap: 2px;
}

.chatTitle {
  font-size: 16px;
  font-weight: 650;
  letter-spacing: 0.01em;
}

.chatSubtitleRow {
  display: flex;
  align-items: center;
  gap: 6px;
}

.chatSubtitle {
  font-size: 12px;
  color: var(--text-2);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 240px;
}

.chatArchivedBadge {
  padding: 2px 6px;
  border-radius: 999px;
  font-size: 10px;
  border: 1px solid color-mix(in srgb, var(--chat-border) 70%, transparent);
  color: var(--chat-text-3);
  background: color-mix(in srgb, var(--chat-surface-chat) 70%, transparent);
  text-transform: uppercase;
  letter-spacing: 0.02em;
}

.chatHeaderActions {
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.chatHeaderBtn {
  width: 34px;
  height: 34px;
  border-radius: 999px;
  border: 1px solid var(--border-1);
  background: transparent;
  color: var(--text);
  font-size: 14px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background var(--chat-hover-tr), border-color var(--chat-hover-tr),
    transform var(--chat-hover-tr);
}

.chatHeaderBtn:hover {
  background: var(--chat-hover);
  border-color: var(--primary-start);
  transform: translateY(-1px);
}

.chatHeaderMenuWrap {
  position: relative;
}

.chatHeaderMenu {
  position: absolute;
  right: 0;
  top: calc(100% + 8px);
  min-width: 180px;
  padding: 6px;
  border-radius: 12px;
  background: var(--card-bg);
  border: 1px solid var(--card-brd);
  box-shadow: var(--shadow);
  -webkit-backdrop-filter: blur(var(--glass-blur));
  backdrop-filter: blur(var(--glass-blur));
  z-index: 20;
}

.chatHeaderMenuItem {
  width: 100%;
  border: none;
  background: transparent;
  color: var(--text-1);
  font-size: var(--fs-sm);
  padding: 10px 12px;
  border-radius: 10px;
  cursor: pointer;
  text-align: left;
}

.chatHeaderMenuItem:hover {
  background: rgba(255, 255, 255, 0.06);
}

/* ===== FLOATING DAY LABEL ===== */

.floatingDayLabel {
  position: absolute;
  top: 64px;
  left: 0;
  right: 0;
  display: flex;
  justify-content: center;
  pointer-events: none;
  z-index: 15;
}

.floatingDayLabelInner {
  padding: 4px 14px;
  border-radius: 999px;
  font-size: 12px;
  letter-spacing: 0.02em;
  background: rgba(255, 255, 255, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.14);
  color: var(--text-3);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);
}

/* Scroll-to-bottom floating button */
.scrollToBottom {
  position: absolute;
  right: 20px;
  bottom: 108px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: 1px solid rgba(255, 255, 255, 0.14);
  background: rgba(255, 255, 255, 0.06);
  color: var(--text-1);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25),
    inset 0 1px 0 rgba(255, 255, 255, 0.14);
  transition: transform var(--chat-hover-tr), background var(--chat-hover-tr),
    border-color var(--chat-hover-tr);
  z-index: 12;
}

.scrollToBottom:hover {
  transform: translateY(-1px);
  background: rgba(255, 255, 255, 0.12);
  border-color: color-mix(in srgb, var(--accent) 55%, transparent);
}

/* ===== MESSAGES ===== */

.messages {
  flex: 1;
  padding: 20px 22px 24px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 8px;
  min-height: 0;
}

.messagesBlocked {
  pointer-events: none;
  overflow: hidden;
  touch-action: none;
}

.messagesScrollable {
}

.messagesScrolled {
}

.messagesSurface {
  flex: 1;
  display: flex;
  min-height: 0;
  margin: 12px var(--space-3) 12px;
  background: transparent;
  border: 1px solid transparent;
  border-radius: var(--radius-lg);
  box-shadow: none;
  position: relative;
  overflow: hidden;
}

/* статичный разделитель даты в ленте */
.dayDivider {
  display: flex;
  justify-content: center;
  margin: 18px 0 12px;
}

.dayDivider > span {
  padding: 4px 14px;
  border-radius: 999px;
  font-size: 11px;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  background: rgba(255, 255, 255, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.12);
  color: var(--text-3);
}

/* общий пузырь (legacy, почти не используется напрямую) */
.message {
  max-width: 70%;
  background: rgba(255, 255, 255, 0.08);
  border-radius: var(--radius-lg);
  border: 1px solid rgba(255, 255, 255, 0.14);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);
  font-size: var(--fs-sm);
  line-height: var(--lh-normal);
  display: flex;
  flex-direction: column;
  padding: var(--space-2) var(--space-3);
}

/* === TELEGRAM-LIKE MESSAGE ROWS === */

.messageWrap {
  display: flex;
  align-items: flex-end;
  margin-bottom: 8px;
  max-width: 66%;
  gap: 6px;
  width: fit-content;
}

.messageWrapStacked {
  margin-top: -4px;
}

.messageWrapActionsOpen .msgActions {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

.messageBody {
  display: flex;
  flex-direction: column;
  gap: 6px;
  max-width: 100%;
}

.messageBodyMe {
  align-items: flex-end;
}

.messageBodyOther {
  align-items: flex-start;
}

/* подсветка выбранных сообщений */
.messageWrapSelected .msgBubble {
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--chat-accent) 85%, transparent);
}

.messageWrapSelected.meWrap .msgBubble {
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--chat-accent-2) 85%, transparent);
}

.messageWrapSelected .attachmentOnlyShell {
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--chat-accent) 85%, transparent);
}

.messageWrapSelected.meWrap .attachmentOnlyShell {
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--chat-accent-2) 85%, transparent);
}

.msgBubbleHighlight {
  animation: msgJumpFlash 0.9s ease-out;
}

@keyframes msgJumpFlash {
  0% {
    box-shadow: 0 0 0 0 rgba(255, 214, 102, 0.75);
    background-color: rgba(255, 248, 204, 0.95);
  }
  40% {
    box-shadow: 0 0 0 6px rgba(255, 214, 102, 0.0);
    background-color: rgba(255, 248, 204, 0.6);
  }
  100% {
    box-shadow: none;
    background-color: inherit;
  }
}

/* мои сообщения — справа */
.meWrap {
  margin-left: auto;
  justify-content: flex-end;
}

/* чужие — слева */
.otherWrap {
  margin-right: auto;
  justify-content: flex-start;
}

/* аватар слева от пузыря */
.msgAvatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--chat-accent), var(--chat-accent-2));
  color: #fff;
  font-weight: 600;
  font-size: 13px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  align-self: flex-end;
}

.avatarImg {
  width: 100%;
  height: 100%;
  display: block;
  object-fit: cover;
  object-position: center;
  border-radius: 50%;
}

/* у моих сообщений аватар не нужен */
.meWrap .msgAvatar {
  display: none;
}

/* сам пузырь */
.msgBubble {
  position: relative;
  background: rgba(255, 255, 255, 0.08);
  padding: 12px 14px 10px;
  border-radius: var(--chat-bubble-radius);
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);
  max-width: 100%;
  word-break: break-word;
}

.msgStackSingle {
}

.msgStackStart {
}

.msgStackMiddle {
}

.msgStackEnd {
}

.otherWrap .msgStackStart {
  border-bottom-left-radius: var(--chat-bubble-stack-radius);
}

.otherWrap .msgStackMiddle {
  border-top-left-radius: var(--chat-bubble-stack-radius);
  border-bottom-left-radius: var(--chat-bubble-stack-radius);
}

.otherWrap .msgStackEnd {
  border-top-left-radius: var(--chat-bubble-stack-radius);
}

.meWrap .msgStackStart {
  border-bottom-right-radius: var(--chat-bubble-stack-radius);
}

.meWrap .msgStackMiddle {
  border-top-right-radius: var(--chat-bubble-stack-radius);
  border-bottom-right-radius: var(--chat-bubble-stack-radius);
}

.meWrap .msgStackEnd {
  border-top-right-radius: var(--chat-bubble-stack-radius);
}

/* Hover actions near bubble */
.msgActions {
  position: absolute;
  top: -20px;
  display: inline-flex;
  gap: 6px;
  opacity: 0;
  transform: translateY(6px);
  transition: opacity var(--chat-hover-tr), transform var(--chat-hover-tr);
  pointer-events: none;
}

.msgActionsMe {
  right: 6px;
}

.msgActionsOther {
  left: 6px;
}

.msgActionBtn {
  min-width: 28px;
  height: 28px;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.14);
  background: rgba(255, 255, 255, 0.06);
  color: var(--text-1);
  font-size: 14px;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  pointer-events: auto;
  transition: background var(--chat-hover-tr), border-color var(--chat-hover-tr),
    transform var(--chat-hover-tr), opacity var(--chat-hover-tr);
}

.msgActionBtn:hover {
  background: rgba(255, 255, 255, 0.12);
  border-color: color-mix(in srgb, var(--accent) 55%, transparent);
  transform: translateY(-1px);
}

.msgActionBtnReact {
  width: auto;
  padding: 0 8px;
  gap: 4px;
}

.msgActionPlus {
  font-size: 12px;
  opacity: 0.7;
}

.msgActionEmoji {
  font-size: 14px;
  line-height: 1;
}

.messageWrap:hover .msgActions {
  opacity: 1;
  transform: translateY(0);
}

/* ===== REACTIONS (UNDER BUBBLE) ===== */

.reactionRow {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-wrap: wrap;
  margin-top: 6px;
}

.reactionRowMe {
  justify-content: flex-end;
}

.reactionRowOther {
  justify-content: flex-start;
}

.reactionPill {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  height: 26px;
  padding: 0 8px;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.16);
  background: rgba(255, 255, 255, 0.06);
  font-size: 12px;
  color: var(--text-1);
  cursor: pointer;
  transition: transform var(--chat-hover-tr), background var(--chat-hover-tr),
    border-color var(--chat-hover-tr), box-shadow var(--chat-hover-tr),
    opacity var(--chat-hover-tr);
}

.reactionPill:hover {
  background: rgba(255, 255, 255, 0.12);
  transform: scale(1.03);
}

.reactionPillActive {
  background: rgba(109, 125, 255, 0.14);
  border-color: rgba(109, 125, 255, 0.4);
  box-shadow: 0 0 0 1px rgba(109, 125, 255, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.18);
}

.reactionEmoji {
  line-height: 1;
}

.reactionCount {
  font-size: 12px;
  color: var(--text-3);
  font-variant-numeric: tabular-nums;
}

/* ===== REACTION PICKER (MVP) ===== */

.reactionPicker {
  position: absolute;
  top: -46px;
  display: inline-flex;
  gap: 6px;
  padding: 8px;
  border-radius: 14px;
  border: 1px solid var(--card-brd);
  background: var(--card-bg);
  box-shadow: var(--shadow);
  z-index: 2000;
  transform-origin: bottom;
  animation: reactionPickerIn var(--chat-open-tr) both;
  -webkit-backdrop-filter: blur(var(--glass-blur));
  backdrop-filter: blur(var(--glass-blur));
}

.reactionPickerMe {
  right: 0;
}

.reactionPickerOther {
  left: 0;
}

.reactionEmojiBtn {
  width: 28px;
  height: 28px;
  border-radius: 10px;
  border: none;
  background: transparent;
  cursor: pointer;
  font-size: 16px;
  transition: transform var(--chat-hover-tr), background var(--chat-hover-tr);
}

.reactionEmojiBtn:hover {
  background: rgba(255, 255, 255, 0.06);
  transform: translateY(-1px);
}

@keyframes reactionPickerIn {
  from {
    opacity: 0;
    transform: translateY(6px) scale(0.96);
    filter: blur(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
    filter: blur(0);
  }
}

/* мои пузыри — градиент */
.meWrap .msgBubble {
  background: var(--chat-bubble-mine);
  border-color: rgba(255, 255, 255, 0.2);
  color: var(--text-1);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2);
}

/* текст */
.msgText {
  white-space: pre-wrap;
  word-break: break-word;
  font-size: 14px;
  line-height: 1.55;
}

.msgTextDeleted {
  color: var(--muted);
  font-style: italic;
  opacity: 0.8;
}

/* время справа внизу */
.msgTime {
  font-size: 10px;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  color: var(--text-3);
  text-align: right;
  margin-top: 4px;
}

.meWrap .msgTime {
  color: var(--text-3);
}

/* имя автора в группе */
.messageAuthorRow {
  margin-bottom: 2px;
}

.messageAuthorName {
  font-size: 12px;
  font-weight: 600;
  opacity: 0.92;
}

/* ===== ХВОСТИКИ ===== */

.otherWrap .msgStackSingle,
.otherWrap .msgStackEnd {
  border-radius: var(--chat-bubble-radius) var(--chat-bubble-radius)
    var(--chat-bubble-radius) 4px;
}

.meWrap .msgStackSingle,
.meWrap .msgStackEnd {
  border-radius: var(--chat-bubble-radius) var(--chat-bubble-radius) 4px
    var(--chat-bubble-radius);
}

/* ===== МЕТА-СТРОКА: ВРЕМЯ + ГАЛОЧКИ ===== */

.msgMetaRow {
  margin-top: 6px;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 6px;
  opacity: 0.9;
}

/* внутри общей мета-строки время без extra-отступа */
.msgMetaRow .msgTime {
  margin-top: 0;
  font-size: 10px;
}

/* контейнер под статус */
.msgStatus {
  display: flex;
  align-items: center;
  font-size: 0;
}

.msgCheckIcon {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
}

.msgCheckLayer {
  position: relative;
  display: inline-block;
  font-size: 10px;
}

.msgCheckLayer + .msgCheckLayer {
  margin-left: -3px;
}

.msgCheckSent {
  color: rgba(255, 255, 255, 0.7);
  opacity: 0.7;
}

.msgCheckPartial {
  color: rgba(255, 255, 255, 0.9);
  opacity: 0.9;
}

.msgCheckRead {
  color: var(--chat-accent-2);
  opacity: 1;
  text-shadow: 0 0 2px rgba(0, 0, 0, 0.35);
}

.meWrap .msgMetaRow {
  justify-content: flex-end;
}

/* ===== ПОДПИСИ REPLY / FORWARD ===== */

/* "Переслано от ..." над текстом */
.msgForwardLabel {
  font-size: var(--fs-xs);
  color: var(--muted);
  margin-bottom: 4px;
}

/* контейнер прелюда ответа */
.msgReplyPreview {
  display: flex;
  align-items: flex-start;
  gap: 6px;
  padding: 4px 6px;
  margin: -2px -4px 4px -4px;
  border-radius: 10px;
  background: color-mix(in srgb, var(--chat-accent) 12%, transparent);
}

.msgReplyPreviewBar {
  width: 3px;
  border-radius: 999px;
  background: var(--chat-accent);
  flex-shrink: 0;
  margin-top: 1px;
}

.msgReplyPreviewContent {
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 1px;
}

.msgReplyPreviewTitle {
  font-size: var(--fs-xs);
  font-weight: var(--fw-medium);
  color: var(--chat-accent);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.msgReplyPreviewText {
  font-size: var(--fs-2xs);
  color: var(--muted);
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

.meWrap .msgReplyPreview {
  background: rgba(0, 0, 0, 0.18);
}

.meWrap .msgReplyPreviewBar {
  background: rgba(255, 255, 255, 0.9);
}

.meWrap .msgReplyPreviewTitle {
  color: #ffffff;
}

/* ===== MEDIA GRID IN MESSAGE ===== */

.mediaGrid {
  margin-top: 6px;
  display: grid;
  gap: 4px;
}

.mediaGrid[data-count="1"] {
  grid-template-columns: 1fr;
}

.mediaGrid[data-count="2"] {
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

.mediaGrid[data-count="3"],
.mediaGrid[data-count="4"] {
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

.mediaTile {
  position: relative;
  border: none;
  padding: 0;
  border-radius: 14px;
  overflow: hidden;
  min-height: 120px;
  background: rgba(255, 255, 255, 0.06);
  cursor: pointer;
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.12);
  transition: transform var(--chat-hover-tr), box-shadow var(--chat-hover-tr),
    background var(--chat-hover-tr);
}

.mediaTileMedia {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.mediaTilePlay {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-size: 20px;
  text-shadow: 0 6px 18px rgba(0, 0, 0, 0.55);
}

.mediaTileOverlay {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-weight: 600;
  font-size: 18px;
  background: rgba(0, 0, 0, 0.45);
}

.mediaTilePlaceholder {
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.06);
}

.mediaTile:hover {
  transform: translateY(-1px) scale(1.01);
  background: rgba(255, 255, 255, 0.1);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.2);
}

/* ===== КНОПКА ⋯ (сейчас не используется, но пусть будет) ===== */

.msgActionsBtn {
  width: 26px;
  height: 26px;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.14);
  background: rgba(255, 255, 255, 0.06);
  color: var(--text-2);
  font-size: 0;
  line-height: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  opacity: 0;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);
  transition: opacity var(--chat-hover-tr), background var(--chat-hover-tr),
    transform var(--chat-hover-tr), border-color var(--chat-hover-tr),
    color var(--chat-hover-tr), box-shadow var(--chat-hover-tr);
}

.msgActionsBtn::before {
  content: "⋮";
  font-size: 16px;
  line-height: 1;
  color: inherit;
}

.messageWrap:hover .msgActionsBtn {
  opacity: 1;
}

.msgActionsBtn:hover {
  background: rgba(255, 255, 255, 0.12);
  border-color: color-mix(in srgb, var(--accent) 55%, transparent);
  color: var(--text-1);
  transform: translateY(-1px);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.18);
}

.meWrap .msgActionsBtn {
  margin-right: 4px;
}

.otherWrap .msgActionsBtn {
  margin-left: 4px;
}

/* ===== INPUT AREA ===== */

.input {
  display: flex;
  align-items: flex-end;
  gap: 12px;
  padding: 12px 16px;
  border-top: none;
  background: transparent;
  box-shadow: none;
}

.inputDragging {
  border-top-color: color-mix(in srgb, var(--accent) 60%, transparent);
  box-shadow: inset 0 0 0 1px var(--focus);
}

.inputRow {
  display: flex;
  align-items: flex-end;
  gap: 12px;
}

.inputMain {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 6px;
  min-width: 0;
}

.inputTextWrap {
  flex: 1;
  display: flex;
  min-width: 0;
}

/* textarea */
.textbox {
  width: 100%;
  min-height: 36px;
  max-height: 35vh;
  padding: 9px 14px;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.14);
  background: rgba(255, 255, 255, 0.06);
  color: var(--text-1);
  font-size: 14px;
  line-height: 1.55;
  outline: none;
  resize: none;
  overflow-y: hidden;
  transition: border-color var(--chat-hover-tr), box-shadow var(--chat-hover-tr),
    background var(--chat-hover-tr);
}

.textbox:focus {
  border-color: color-mix(in srgb, var(--accent) 60%, transparent);
  box-shadow: 0 0 0 2px var(--focus);
  background: rgba(255, 255, 255, 0.1);
}

.textbox::placeholder {
  color: var(--text-3);
}

/* маленькие круглые иконки */
.inputIconBtn {
  width: 36px;
  height: 36px;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.14);
  background: rgba(255, 255, 255, 0.06);
  color: var(--text-2);
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  flex-shrink: 0;
  transition: background var(--chat-hover-tr), border-color var(--chat-hover-tr),
    transform var(--chat-hover-tr), color var(--chat-hover-tr),
    opacity var(--chat-hover-tr);
}

.inputIconBtn:hover {
  background: rgba(255, 255, 255, 0.12);
  border-color: color-mix(in srgb, var(--accent) 55%, transparent);
  color: var(--text-1);
  transform: translateY(-1px);
}

.inputFile {
  display: none;
}

.attachmentsWrap {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-top: 6px;
}

.attachmentOnlyShell {
  position: relative;
  padding: 4px;
  border-radius: 14px;
  background: transparent;
}

.attachmentMetaRow {
  margin-top: 6px;
  display: flex;
  align-items: center;
  gap: 6px;
  justify-content: flex-end;
}

.messageBodyOther .attachmentMetaRow {
  justify-content: flex-start;
}

.composerAttachmentsRow {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  padding: 2px 2px 4px;
}

.composerAttachmentItem {
  position: relative;
  display: flex;
  flex-direction: column;
  gap: 4px;
  min-width: 56px;
}

.composerAttachmentThumb {
  width: 56px;
  height: 56px;
  border-radius: 14px;
  overflow: hidden;
  border: 1px solid rgba(255, 255, 255, 0.14);
  background: rgba(255, 255, 255, 0.06);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

.composerAttachmentThumb img,
.composerAttachmentThumb video {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.composerAttachmentIcon {
  font-size: 11px;
  font-weight: 700;
  color: var(--text-3);
}

.composerAttachmentPlay {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #ffffff;
  font-size: 18px;
  text-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
  pointer-events: none;
}

.composerAttachmentRemove {
  position: absolute;
  top: -6px;
  right: -6px;
  width: 20px;
  height: 20px;
  border-radius: 8px;
  border: 1px solid rgba(255, 255, 255, 0.16);
  background: rgba(255, 255, 255, 0.08);
  color: var(--text-1);
  font-size: 11px;
  cursor: pointer;
}

.composerAttachmentOverlay {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.45);
  color: var(--text-2);
  font-size: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  gap: 4px;
  text-align: center;
  padding: 4px;
}

.composerAttachmentOverlay::before {
  content: "";
  width: 14px;
  height: 14px;
  border-radius: 50%;
  border: 2px solid color-mix(in srgb, var(--text-3) 75%, transparent);
  border-top-color: transparent;
  animation: composerSpin 0.8s linear infinite;
}

.composerAttachmentOverlayError {
  position: absolute;
  inset: 0;
  background: color-mix(in srgb, var(--danger) 18%, transparent);
  color: var(--danger);
  font-size: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 4px;
}

@keyframes composerSpin {
  to {
    transform: rotate(360deg);
  }
}

.composerAttachmentActions {
  display: flex;
  gap: 6px;
}

.composerAttachmentMore {
  width: 56px;
  height: 56px;
  border-radius: 12px;
  border: 1px dashed rgba(255, 255, 255, 0.16);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  color: var(--text-3);
  flex-shrink: 0;
}

.sendErrorBar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  padding: 6px 10px;
  border: 1px solid color-mix(in srgb, var(--danger) 60%, transparent);
  background: color-mix(in srgb, var(--danger) 12%, transparent);
  border-radius: 8px;
  font-size: var(--fs-xs);
  color: var(--danger);
}

.sendErrorBtn {
  border: 1px solid color-mix(in srgb, var(--danger) 70%, transparent);
  background: transparent;
  color: var(--danger);
  border-radius: 8px;
  padding: 4px 8px;
  font-size: var(--fs-xs);
  cursor: pointer;
}

.sendErrorBtn:hover {
  background: color-mix(in srgb, var(--danger) 18%, transparent);
}

.attachmentUploading {
  font-size: var(--fs-xs);
  color: var(--muted);
}

.attachmentCard {
  border: 1px solid rgba(255, 255, 255, 0.14);
  border-radius: 16px;
  padding: 10px 12px;
  background: rgba(255, 255, 255, 0.06);
  display: flex;
  flex-direction: column;
  gap: 8px;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);
}

.attachmentCardMedia {
  flex-direction: column;
}

.attachmentCardFile {
  flex-direction: row;
  align-items: center;
  gap: 12px;
}

.attachmentDocHeader {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 10px;
  border-radius: 12px;
  background: color-mix(in srgb, var(--topbar-bg) 85%, transparent);
  border: 1px solid var(--card-brd);
}

.attachmentDocIcon {
  width: 40px;
  height: 40px;
  border-radius: 12px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: color-mix(in srgb, var(--card-bg) 80%, transparent);
  border: 1px solid var(--card-brd);
  flex-shrink: 0;
}

.attachmentDocPreview {
  margin-top: 8px;
  border-radius: 14px;
  overflow: hidden;
  border: 1px solid var(--card-brd);
  background: color-mix(in srgb, var(--topbar-bg) 78%, transparent);
  cursor: pointer;
}

.attachmentDocFrame {
  width: 100%;
  height: 420px;
  max-height: 420px;
  border: none;
  display: block;
  background: transparent;
}

.attachmentDocFallback {
  padding: 18px;
  font-size: 12px;
  color: var(--text-3);
  text-align: center;
}

.attachmentPreview {
  width: 100%;
  border-radius: 14px;
  overflow: hidden;
  background: rgba(255, 255, 255, 0.05);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.12);
}

.attachmentImg {
  width: 100%;
  max-height: 320px;
  object-fit: cover;
  display: block;
}

.attachmentPdf {
  width: 100%;
  height: 420px;
  max-height: 420px;
  border: none;
  border-radius: 14px;
  background: rgba(255, 255, 255, 0.03);
}

.attachmentAudio {
  width: 100%;
}

.attachmentVideo {
  width: 100%;
  max-height: 320px;
  border-radius: 14px;
  object-fit: contain;
}

.attachmentFileIcon {
  width: 40px;
  height: 40px;
  border-radius: 12px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.08);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.16);
  flex-shrink: 0;
}

.attachmentFileBadge {
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 0.08em;
  color: var(--text-1);
}

.attachmentMeta {
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 0;
  flex: 1;
}

.attachmentName {
  font-weight: 600;
  font-size: 13px;
  color: var(--text-1);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.attachmentSub {
  font-size: 11px;
  color: var(--text-3);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.attachmentActions {
  display: flex;
  justify-content: flex-end;
  gap: 6px;
  margin-left: auto;
  align-items: center;
}

.attachmentBtn {
  min-width: 32px;
  height: 32px;
  border: 1px solid rgba(255, 255, 255, 0.16);
  background: rgba(255, 255, 255, 0.06);
  color: var(--text-1);
  border-radius: 999px;
  padding: 0 10px;
  font-size: 11px;
  cursor: pointer;
  transition: transform var(--chat-hover-tr), border-color var(--chat-hover-tr),
    background var(--chat-hover-tr);
}

.attachmentBtn:hover {
  border-color: rgba(255, 255, 255, 0.24);
  background: rgba(255, 255, 255, 0.12);
  transform: translateY(-1px);
}

.attachmentBtnDanger {
  border: 1px solid color-mix(in srgb, var(--danger) 45%, transparent);
  background: color-mix(in srgb, var(--danger) 12%, transparent);
  color: var(--danger);
  border-radius: 999px;
  min-width: 32px;
  height: 32px;
  padding: 0 10px;
  font-size: 11px;
  cursor: pointer;
}

.attachmentBtnDanger:hover {
  background: color-mix(in srgb, var(--danger) 28%, transparent);
}

/* кнопка отправки */
.sendIconBtn {
  width: 40px;
  height: 40px;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  background: rgba(255, 255, 255, 0.08);
  color: #fff;
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  flex-shrink: 0;
  box-shadow: 0 18px 38px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.25),
    0 0 24px rgba(109, 125, 255, 0.25);
  transition: transform var(--chat-hover-tr), box-shadow var(--chat-hover-tr),
    opacity var(--chat-hover-tr), filter var(--chat-hover-tr);
}

.sendIconBtn:disabled {
  opacity: 0.45;
  box-shadow: none;
  cursor: default;
}

.sendIconBtn:not(:disabled):hover {
  transform: translateY(-1px);
  box-shadow: 0 20px 42px rgba(0, 0, 0, 0.32),
    inset 0 1px 0 rgba(255, 255, 255, 0.28),
    0 0 30px rgba(109, 125, 255, 0.32);
}

.sendIconBtn:not(:disabled):active {
  transform: translateY(0);
  box-shadow: 0 8px 18px rgba(0, 0, 0, 0.25);
}

/* ------------------------------- */
/*      CREATE DIRECT / GROUP      */
/* ------------------------------- */

.createWrap {
  display: flex;
  flex-direction: column;
  height: 100%;
  padding: 24px;
  background: var(--card-bg);
  border: 1px solid var(--card-brd);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow);
  -webkit-backdrop-filter: blur(var(--glass-blur));
  backdrop-filter: blur(var(--glass-blur));
  color: var(--text-1);
  overflow: hidden;
}

.createHeader {
  margin-bottom: 20px;
}

.createTitle {
  font-size: 22px;
  font-weight: 650;
  color: var(--chat-text-1);
  margin-bottom: 4px;
}

.createSubtitle {
  font-size: 14px;
  color: var(--chat-text-2);
}

/* SEARCH INPUT */
.createSearch {
  margin-bottom: 16px;
}

.createSearchInput {
  width: 100%;
  padding: 16px 20px;
  background: color-mix(in srgb, var(--chat-surface-chat) 70%, transparent);
  border: 1px solid color-mix(in srgb, var(--chat-border) 70%, transparent);
  border-radius: 14px;
  outline: none;
  color: var(--chat-text-1);
  font-size: 15px;
  transition: border-color var(--chat-hover-tr), background var(--chat-hover-tr),
    box-shadow var(--chat-hover-tr);
}

.createSearchInput::placeholder {
  color: var(--chat-text-3);
}

.createSearchInput:focus {
  border-color: color-mix(in srgb, var(--chat-accent) 60%, transparent);
  background: color-mix(in srgb, var(--chat-surface-chat) 82%, transparent);
  box-shadow: 0 0 0 1px color-mix(in srgb, var(--chat-accent) 35%, transparent);
}

/* ERROR */
.createError {
  padding: 12px;
  background: color-mix(in srgb, var(--danger) 14%, transparent);
  border: 1px solid color-mix(in srgb, var(--danger) 35%, transparent);
  border-radius: 10px;
  color: var(--danger);
  font-size: 14px;
  margin-bottom: 16px;
}

/* USER LIST */
.userList {
  flex: 1;
  overflow-y: auto;
  padding: 20px 0;
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.userList::-webkit-scrollbar {
  width: 6px;
}

.userList::-webkit-scrollbar-thumb {
  background: color-mix(in srgb, var(--chat-border) 90%, transparent);
  border-radius: 8px;
}

/* ОДНА СТРОКА ПОЛЬЗОВАТЕЛЯ */
.userRow {
  width: calc(100% - 24px);
  margin: 0 auto;
  display: flex;
  align-items: center;
  padding: 30px 22px;
  border-radius: 18px;
  background: color-mix(in srgb, var(--chat-surface-chat) 82%, transparent);
  border: 1px solid color-mix(in srgb, var(--chat-border) 70%, transparent);
  cursor: pointer;
  transition: background var(--chat-hover-tr), border-color var(--chat-hover-tr),
    transform var(--chat-hover-tr), box-shadow var(--chat-hover-tr);
}

.userRow:hover {
  background: color-mix(in srgb, var(--chat-surface-chat) 92%, transparent);
  border-color: color-mix(in srgb, var(--chat-border-strong) 70%, transparent);
  transform: translateY(-1px);
}

/* выбрана (для группы) */
.userRowSelected {
  background: color-mix(in srgb, var(--chat-accent) 18%, transparent);
  border-color: color-mix(in srgb, var(--chat-accent) 60%, transparent);
  box-shadow: 0 10px 22px rgba(0, 0, 0, 0.35);
}

/* AVATAR */
.userAvatar {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  flex-shrink: 0;
  margin-right: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  color: #fff;
  background: linear-gradient(135deg, var(--chat-accent), var(--chat-accent-2));
  font-size: 17px;
}

.userInitials {
  pointer-events: none;
}

/* Имя + email */
.userMain {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.userName {
  font-size: 16px;
  font-weight: 600;
}

.userEmail {
  font-size: 14px;
  color: var(--chat-text-3);
}

/* Кружок выбора справа */
.userCheckWrap {
  margin-left: 18px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.userCheckCircle {
  width: 22px;
  height: 22px;
  border-radius: 50%;
  border: 2px solid color-mix(in srgb, var(--chat-border-strong) 70%, transparent);
  opacity: 0.85;
  display: flex;
  align-items: center;
  justify-content: center;
}

.userBusyDot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--chat-accent);
}

/* FOOTER ДЛЯ ГРУППЫ */
.createFooter {
  padding-top: 16px;
  margin-top: 4px;
  border-top: 1px solid color-mix(in srgb, var(--chat-border) 70%, transparent);
  display: flex;
  gap: 12px;
}

.groupTitleInput {
  flex: 1;
  padding: 12px 16px;
  border-radius: 14px;
  border: 1px solid color-mix(in srgb, var(--chat-border) 70%, transparent);
  background: color-mix(in srgb, var(--chat-surface-chat) 70%, transparent);
  color: var(--chat-text-1);
  font-size: 14px;
  outline: none;
  transition: border-color var(--chat-hover-tr), background var(--chat-hover-tr),
    box-shadow var(--chat-hover-tr);
}

.groupTitleInput::placeholder {
  color: var(--chat-text-3);
}

.groupTitleInput:focus {
  border-color: color-mix(in srgb, var(--chat-accent) 60%, transparent);
  background: color-mix(in srgb, var(--chat-surface-chat) 82%, transparent);
  box-shadow: 0 0 0 1px color-mix(in srgb, var(--chat-accent) 35%, transparent);
}

.groupCreateBtn {
  padding: 0 20px;
  border-radius: 999px;
  border: none;
  background: linear-gradient(135deg, var(--chat-accent), var(--chat-accent-2));
  color: #fff;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  white-space: nowrap;
  box-shadow: 0 12px 26px rgba(79, 120, 255, 0.32);
  transition: transform var(--chat-hover-tr), box-shadow var(--chat-hover-tr),
    filter var(--chat-hover-tr);
}

.groupCreateBtn:disabled {
  opacity: 0.4;
  cursor: default;
}

.groupCreateBtn:not(:disabled):hover {
  transform: translateY(-1px);
  filter: brightness(1.05);
}

/* BACK BUTTON */

.backBtn {
  width: 34px;
  height: 34px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.06);
  color: var(--text-2);
  border: 1px solid rgba(255, 255, 255, 0.14);
  cursor: pointer;
  transition: background var(--chat-hover-tr), border-color var(--chat-hover-tr),
    transform var(--chat-hover-tr), color var(--chat-hover-tr);
  position: absolute;
  left: var(--space-4);
  top: 50%;
  transform: translateY(-50%);
}

.chatHeaderSearchBtn {
  width: 34px;
  height: 34px;
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.14);
  background: rgba(255, 255, 255, 0.06);
  color: var(--text-1);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  position: absolute;
  right: var(--space-4);
  top: 50%;
  transform: translateY(-50%);
  transition: background var(--chat-hover-tr), border-color var(--chat-hover-tr),
    transform var(--chat-hover-tr);
}

.chatHeaderSearchBtn:hover {
  background: rgba(255, 255, 255, 0.12);
  border-color: color-mix(in srgb, var(--accent) 55%, transparent);
  transform: translateY(-50%) translateY(-1px);
}

.chatHeaderSearch {
  width: min(760px, calc(100% - 24px));
  height: 36px;
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 0 12px;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.14);
  background: rgba(255, 255, 255, 0.06);
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.14);
}

.chatHeaderSearch:focus-within {
  border-color: color-mix(in srgb, var(--accent) 60%, transparent);
  box-shadow: 0 0 0 2px var(--focus),
    0 16px 36px rgba(0, 0, 0, 0.35);
}

.chatHeaderSearchIcon {
  color: var(--text-3);
  font-size: 15px;
}

.chatHeaderSearchInput {
  flex: 1;
  border: none;
  background: transparent;
  color: var(--text-1);
  font-size: 14px;
  outline: none;
}

.chatHeaderSearchMeta {
  display: flex;
  align-items: center;
  gap: 6px;
}

.chatHeaderSearchCounter {
  min-width: 42px;
  text-align: center;
  font-size: 12px;
  color: var(--text-3);
  font-variant-numeric: tabular-nums;
}

.chatHeaderSearchNavBtn {
  width: 28px;
  height: 28px;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.16);
  background: rgba(255, 255, 255, 0.06);
  color: var(--text-2);
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: background var(--chat-hover-tr), border-color var(--chat-hover-tr),
    transform var(--chat-hover-tr), opacity var(--chat-hover-tr);
}

.chatHeaderSearchNavBtn:disabled {
  opacity: 0.4;
  cursor: default;
}

.chatHeaderSearchNavBtn:not(:disabled):hover {
  background: rgba(255, 255, 255, 0.12);
  border-color: color-mix(in srgb, var(--accent) 55%, transparent);
  transform: translateY(-1px);
}

.chatHeaderSearchClose {
  width: 28px;
  height: 28px;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.16);
  background: rgba(255, 255, 255, 0.06);
  color: var(--text-2);
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.chatHeaderSearchClose:hover {
  background: rgba(255, 255, 255, 0.12);
  border-color: color-mix(in srgb, var(--accent) 55%, transparent);
  color: var(--text-1);
}

.backBtn:hover {
  background: rgba(255, 255, 255, 0.12);
  border-color: color-mix(in srgb, var(--accent) 55%, transparent);
  color: var(--text-1);
  transform: translateY(-50%) translateY(-1px);
}

/* ===== SEARCH BAR IN CHAT HEADER ===== */

.chatSearchBar {
  padding: 4px var(--space-4) 6px;
  border-bottom: 1px solid var(--border-2);
  display: flex;
  align-items: center;
  gap: 8px;
  background: rgba(15, 22, 36, 0.45);
}

.chatSearchInput {
  flex: 1;
  padding: 6px 10px;
  border-radius: var(--radius-md);
  border: 1px solid rgba(255, 255, 255, 0.14);
  background: rgba(255, 255, 255, 0.06);
  font-size: var(--fs-xs);
  color: var(--text-1);
  outline: none;
  transition: border-color var(--chat-hover-tr), background var(--chat-hover-tr),
    box-shadow var(--chat-hover-tr);
}

.chatSearchInput::placeholder {
  color: var(--text-3);
}

.chatSearchInput:focus {
  background: rgba(255, 255, 255, 0.1);
  border-color: color-mix(in srgb, var(--accent) 60%, transparent);
  box-shadow: 0 0 0 2px var(--focus);
}

.chatSearchCounter {
  min-width: 52px;
  text-align: center;
  font-size: var(--fs-2xs);
  color: var(--text-3);
  font-variant-numeric: tabular-nums;
}

.chatSearchNavBtn {
  width: 28px;
  height: 28px;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.16);
  background: rgba(255, 255, 255, 0.06);
  font-size: 11px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background var(--chat-hover-tr), border-color var(--chat-hover-tr),
    transform var(--chat-hover-tr), opacity var(--chat-hover-tr);
}

.chatSearchNavBtn:disabled {
  opacity: 0.4;
  cursor: default;
}

.chatSearchNavBtn:not(:disabled):hover {
  background: rgba(255, 255, 255, 0.12);
  border-color: color-mix(in srgb, var(--accent) 55%, transparent);
  transform: translateY(-1px);
}

/* подсветка совпадений */
.msgHighlight {
  background: color-mix(in srgb, var(--danger) 80%, transparent);
  border-radius: 4px;
  padding: 0 1px;
}

.chatSearchCloseBtn {
  width: 28px;
  height: 28px;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.16);
  background: rgba(255, 255, 255, 0.06);
  color: var(--text-2);
  font-size: 14px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background var(--chat-hover-tr), border-color var(--chat-hover-tr),
    transform var(--chat-hover-tr), opacity var(--chat-hover-tr);
}

.chatSearchCloseBtn:hover {
  background: rgba(255, 255, 255, 0.12);
  color: var(--text-1);
  border-color: color-mix(in srgb, var(--accent) 55%, transparent);
  transform: translateY(-1px);
}

/* ===== CONTEXT MENU ===== */

.ctxOverlay {
  position: fixed;
  inset: 0;
  z-index: 3000;
  pointer-events: auto;
  background: transparent;
  display: flex;
  align-items: center;
  justify-content: center;
}

.ctxMenu {
  position: fixed;
  min-width: 170px;
  max-width: 220px;
  background: var(--card-bg);
  color: var(--text-1);
  border-radius: 16px;
  border: 1px solid var(--card-brd);
  box-shadow: var(--shadow);
  -webkit-backdrop-filter: blur(var(--glass-blur));
  backdrop-filter: blur(var(--glass-blur));
  overflow: hidden;
  font-size: 14px;
  animation: ctxMenuFadeIn var(--chat-open-tr) both;
  transform-origin: 50% 50%;
}

.ctxMenu[data-side="me"] {
  transform-origin: 100% 50%;
}

.ctxMenu[data-side="other"] {
  transform-origin: 0% 50%;
}

.ctxMenuItem {
  width: 100%;
  min-height: 40px;
  padding: 8px 14px;
  background: none;
  border: none;
  border-radius: none;
  outline: none;
  color: var(--text-1);
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  text-align: left;
  white-space: nowrap;
}

.ctxMenuItem:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.ctxMenuItem:hover {
  background: rgba(255, 255, 255, 0.06);
}

.ctxMenuItemDanger {
  color: rgba(255, 120, 120, 0.92);
}

.ctxMenuItemDanger:hover {
  background: color-mix(in srgb, rgba(255, 120, 120, 0.92) 12%, transparent);
}

.ctxMenuSeparator {
  margin: 4px 0;
  border-top: 1px solid color-mix(in srgb, var(--chat-border) 70%, transparent);
}

.ctxMenuIcon {
  width: 18px;
  display: inline-flex;
  justify-content: center;
  align-items: center;
  opacity: 0.9;
  font-size: 14px;
}

@keyframes ctxMenuFadeIn {
  from {
    opacity: 0;
    transform: scale(0.96) translateY(4px);
    filter: blur(6px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
    filter: blur(0);
  }
}

/* ===== REPLY / FORWARD BANNER над инпутом ===== */

.replyWrap {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  padding: 4px 8px;
  border-radius: 10px;
  background: color-mix(in srgb, var(--card-bg) 96%, transparent);
  border: 1px solid color-mix(in srgb, var(--card-brd) 85%, transparent);
  max-width: 100%;
  overflow: hidden;
}

.replyLeft {
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 0;
}

.replyIcon {
  width: 20px;
  height: 20px;
  border-radius: 999px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  background: color-mix(in srgb, var(--chat-accent) 18%, transparent);
  color: var(--chat-accent);
  flex-shrink: 0;
}

.replyTexts {
  display: flex;
  flex-direction: column;
  min-width: 0;
  max-width: 100%;
}

.replyTitle {
  font-size: var(--fs-xs);
  font-weight: var(--fw-medium);
  color: var(--chat-accent);
  margin-bottom: 1px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.replyText {
  font-size: var(--fs-2xs);
  color: var(--muted);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.replyCloseBtn {
  width: 20px;
  height: 20px;
  border-radius: 999px;
  border: 1px solid color-mix(in srgb, var(--card-brd) 80%, transparent);
  background: transparent;
  color: var(--muted);
  font-size: 11px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  flex-shrink: 0;
  transition: background var(--chat-hover-tr), border-color var(--chat-hover-tr),
    color var(--chat-hover-tr), transform var(--chat-hover-tr),
    opacity var(--chat-hover-tr);
}

.replyCloseBtn:hover {
  background: color-mix(in srgb, var(--chat-accent) 14%, transparent);
  border-color: color-mix(in srgb, var(--chat-accent) 55%, transparent);
  color: var(--chat-text-1);
  transform: translateY(-1px);
}

/* ===== MODAL: ПЕРЕСЛАТЬ СООБЩЕНИЕ ===== */

.forwardModal {
  position: relative;
  width: 420px;
  max-width: 90vw;
  max-height: 520px;
  display: flex;
  flex-direction: column;
  padding: 12px 14px 14px;
  border-radius: 18px;
  background: var(--card-bg);
  box-shadow: var(--shadow);
  border: 1px solid var(--card-brd);
  -webkit-backdrop-filter: blur(var(--glass-blur));
  backdrop-filter: blur(var(--glass-blur));
  color: var(--chat-text-1);
  font-size: 14px;
  animation: forwardModalFadeIn var(--chat-open-tr) both;
}

@keyframes forwardModalFadeIn {
  from {
    opacity: 0;
    transform: scale(0.96) translateY(6px);
    filter: blur(6px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
    filter: blur(0);
  }
}

.forwardHeader {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 2px 2px 8px;
  margin-bottom: 4px;
  border-bottom: 1px solid color-mix(in srgb, var(--chat-border) 70%, transparent);
}

.forwardTitle {
  font-size: 14px;
  font-weight: 600;
  color: var(--chat-text-1);
}

.forwardCloseBtn {
  width: 24px;
  height: 24px;
  border-radius: 999px;
  border: 1px solid color-mix(in srgb, var(--chat-border) 70%, transparent);
  background: color-mix(in srgb, var(--chat-surface-chat) 70%, transparent);
  color: var(--chat-text-2);
  font-size: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background var(--chat-hover-tr), border-color var(--chat-hover-tr),
    color var(--chat-hover-tr), transform var(--chat-hover-tr);
}

.forwardCloseBtn:hover {
  background: color-mix(in srgb, var(--chat-accent) 16%, transparent);
  border-color: color-mix(in srgb, var(--chat-accent) 55%, transparent);
  color: var(--chat-text-1);
  transform: translateY(-1px);
}

/* список чатов */

.forwardList {
  margin-top: 4px;
  padding: 2px;
  flex: 1;
  overflow-y: auto;
}

.forwardList::-webkit-scrollbar {
  width: 6px;
}

.forwardList::-webkit-scrollbar-thumb {
  background: color-mix(in srgb, var(--chat-border) 90%, transparent);
  border-radius: 999px;
}

/* строка чата */

.forwardItem {
  width: 100%;
  padding: 8px 10px;
  border-radius: 12px;
  border: none;
  background: transparent;
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  color: inherit;
  text-align: left;
  transition: background var(--chat-hover-tr), transform var(--chat-hover-tr),
    box-shadow var(--chat-hover-tr);
}

.forwardItem:hover {
  background: color-mix(in srgb, var(--chat-hover) 100%, transparent);
  transform: translateY(-1px);
  box-shadow: 0 10px 22px rgba(0, 0, 0, 0.35);
}

.forwardItemCurrent {
  background: color-mix(in srgb, var(--chat-accent) 18%, transparent);
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.45);
}

/* аватарка комнаты */

.forwardItemAvatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--chat-accent), var(--chat-accent-2));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: 600;
  color: #ffffff;
  flex-shrink: 0;
}

/* текст справа от аватарки */

.forwardItemTexts {
  display: flex;
  flex-direction: column;
  min-width: 0;
}

.forwardItemTitle {
  font-size: 13px;
  font-weight: 600;
  color: var(--chat-text-1);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.forwardItemSub {
  font-size: 11px;
  color: var(--chat-text-3);
  margin-top: 2px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ===== НИЖНЯЯ ПАНЕЛЬ ВЫБОРА СООБЩЕНИЙ ===== */

.selectBar {
  position: relative;
  z-index: 5;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 10px 16px 11px;
  border-top: 1px solid var(--card-brd);
  background: var(--card-bg);
  color: var(--text-1);
  font-size: 14px;
  box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.25),
    inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.selectBarLabel {
  flex: 1;
  text-align: center;
  font-size: 14px;
  font-weight: 500;
}

.selectBarBtnDanger,
.selectBarBtnPrimary {
  border-radius: 999px;
  border: 1px solid transparent;
  padding: 6px 14px;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  white-space: nowrap;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: background var(--chat-hover-tr), border-color var(--chat-hover-tr),
    transform var(--chat-hover-tr), box-shadow var(--chat-hover-tr);
}

.selectBarBtnDanger {
  background: color-mix(in srgb, var(--danger) 10%, transparent);
  color: var(--danger);
}

.selectBarBtnDanger:hover {
  background: color-mix(in srgb, var(--danger) 18%, transparent);
  border-color: color-mix(in srgb, var(--danger) 40%, transparent);
}

.selectBarBtnPrimary {
  background: linear-gradient(135deg, var(--chat-accent), var(--chat-accent-2));
  color: #ffffff;
  box-shadow: 0 10px 24px rgba(79, 120, 255, 0.25);
}

.selectBarBtnPrimary:disabled {
  opacity: 0.4;
  cursor: default;
  box-shadow: none;
}

.selectBarBtnPrimary:not(:disabled):hover {
  transform: translateY(-1px);
  box-shadow: 0 12px 28px rgba(79, 120, 255, 0.32);
}

/* ================= PINNED BAR ================= */

.pinnedBar {
  position: sticky;
  top: 64px; /* твой header */
  z-index: 20;

  display: flex;
  align-items: center;
  justify-content: space-between;

  padding: 10px 14px;
  border-radius: 14px;

  margin: 8px 16px 4px;

  background: var(--card-bg);
  border: 1px solid var(--card-brd);
  box-shadow: var(--shadow);

  cursor: pointer;
  transition: transform var(--chat-hover-tr), box-shadow var(--chat-hover-tr),
    border-color var(--chat-hover-tr), background var(--chat-hover-tr);
}

html.light .pinnedBar {
  background: rgba(255, 255, 255, 0.6);
  border: 1px solid rgba(0, 0, 0, 0.05);
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}

.pinnedBar:hover {
  transform: translateY(-1px);
  box-shadow: 0 14px 32px rgba(0, 0, 0, 0.3);
}

html.light .pinnedBar:hover {
  box-shadow: 0 6px 16px rgba(0,0,0,0.1);
}

/* collapsed */
.pinnedCollapsed {
  opacity: 0.65;
  transform: scale(0.98);
}

/* текст внутри */
.pinnedLeft {
  display: flex;
  flex-direction: column;
  gap: 4px;
  max-width: calc(100% - 64px);
}

.pinnedPreview {
  font-size: 13px;
  color: var(--text-2);
  line-height: 1.3;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* кнопки */
.pinnedCollapseBtn,
.pinnedCloseBtn {
  background: rgba(255, 255, 255, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.16);
  color: var(--text-2);
  cursor: pointer;

  width: 30px;
  height: 30px;

  border-radius: 10px;

  display: flex;
  align-items: center;
  justify-content: center;

  transition: background var(--chat-hover-tr), border-color var(--chat-hover-tr),
    transform var(--chat-hover-tr), color var(--chat-hover-tr);
}

html.light .pinnedCollapseBtn,
html.light .pinnedCloseBtn {
  background: rgba(0, 0, 0, 0.05);
  color: black;
}

.pinnedCollapseBtn:hover,
.pinnedCloseBtn:hover {
  background: rgba(255, 255, 255, 0.08);
  border-color: color-mix(in srgb, var(--accent) 45%, transparent);
  color: var(--text-1);
  transform: translateY(-1px);
}

html.light .pinnedCollapseBtn:hover,
html.light .pinnedCloseBtn:hover {
  background: rgba(0, 0, 0, 0.1);
}

.pinnedCloseBtn {
  margin-left: 6px;
}

.pinnedBarSwitch {
  animation: pinnedSwitch var(--chat-open-tr) both;
}

@keyframes pinnedSwitch {
  0% {
    transform: translateY(-6px);
    opacity: 0;
  }
  100% {
    transform: translateY(0);
    opacity: 1;
  }
}

/* в ChatPage.module.css */
.systemMessageWrap {
  display: flex;
  justify-content: center;
  padding: 4px 0;
}

.systemMessageInner {
  max-width: 80%;
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 12px;
  line-height: 1.4;
  text-align: center;
  opacity: 0.85;
  background: color-mix(in srgb, var(--chat-surface-chat) 82%, transparent);
  border: 1px solid color-mix(in srgb, var(--chat-border) 70%, transparent);
}

/* Кнопка "Показать более ранние сообщения" под pinned-баром (для Safari) */
.loadMoreWrapper {
  padding: 6px 16px 0;
  display: flex;
  justify-content: center;
  align-items: center;
}

.loadMoreBtn {
  padding: 6px 14px;
  border-radius: 999px;
  border: 1px solid color-mix(in srgb, var(--chat-border) 70%, transparent);
  background: color-mix(in srgb, var(--chat-surface-overlay) 86%, transparent);
  color: var(--chat-text-1);
  font-size: 13px;
  line-height: 1.2;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  box-shadow: var(--chat-shadow-1);
  transition:
    background var(--chat-hover-tr),
    transform var(--chat-hover-tr),
    box-shadow var(--chat-hover-tr),
    border-color var(--chat-hover-tr),
    color var(--chat-hover-tr);
}

.loadMoreBtn:hover:not(:disabled) {
  background: color-mix(in srgb, var(--chat-surface-overlay) 92%, transparent);
  transform: translateY(-1px);
  box-shadow: 0 10px 26px rgba(0, 0, 0, 0.35);
  border-color: color-mix(in srgb, var(--chat-accent) 45%, transparent);
}

.loadMoreBtn:active:not(:disabled) {
  transform: translateY(0);
  box-shadow: 0 4px 14px rgba(0, 0, 0, 0.35);
}

.loadMoreBtn:disabled {
  opacity: 0.6;
  cursor: default;
  box-shadow: none;
}

/* ===== GLASS TARGETS (CHAT ONLY) ===== */
[data-ui="chat-sidebar"],
[data-ui="chat-header"],
[data-ui="chat-messages"],
[data-ui="chat-composer"] {
  position: relative;
  background: var(--card-bg);
}

[data-ui="chat-sidebar"] {
  background: var(--sidebar-bg);
  border-right: 1px solid var(--sidebar-brd);
  box-shadow: var(--shadow);
}

[data-ui="chat-header"] {
  background: var(--topbar-bg);
  border-bottom: 1px solid var(--topbar-brd);
}

[data-ui="chat-messages"] {
  background: color-mix(in srgb, var(--topbar-bg) 80%, #000 20%);
  border: 1px solid var(--card-brd);
  box-shadow: var(--shadow);
}

[data-ui="chat-composer"] {
  background: var(--card-bg);
  border: 1px solid var(--card-brd);
  box-shadow: var(--shadow);
  border-radius: var(--radius-lg);
  margin: 8px 12px 12px;
}

@supports ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {
  [data-ui="chat-sidebar"],
  [data-ui="chat-header"],
  [data-ui="chat-messages"],
  [data-ui="chat-composer"] {
    -webkit-backdrop-filter: blur(var(--glass-blur));
    backdrop-filter: blur(var(--glass-blur));
  }
}

@media (max-width: 1200px) {
  .messageWrap {
    max-width: 76%;
  }
}

@media (max-width: 900px) {
  .messageWrap {
    max-width: 86%;
  }

  .messagesSurface {
    margin: 10px var(--space-2);
  }
}
