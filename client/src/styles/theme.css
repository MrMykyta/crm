/* ========= CORE TOKENS ========= */

/* Базовая шкала REM управляется var(--font-scale)
   -> 1rem = 16px * (font-scale/100)  (ставится в ThemeProvider)
*/
:root {
  /* ===== Premium dark tokens ===== */
  --surface-0: #0b0f16;   /* page */
  --surface-1: rgba(15, 23, 36, 0.55);   /* sidebar glass */
  --surface-2: rgba(13, 20, 33, 0.42);   /* chat canvas glass */
  --surface-3: rgba(17, 26, 40, 0.6);    /* popover / modal glass */

  --text-1: rgba(255,255,255,.92);
  --text-2: rgba(255,255,255,.7);
  --text-3: rgba(255,255,255,.45);

  --border-1: rgba(255,255,255,.18);
  --border-2: rgba(255,255,255,.1);

  --shadow-1: 0 22px 70px rgba(0,0,0,.4), 0 6px 20px rgba(0,0,0,.28),
    0 1px 0 rgba(255,255,255,.08) inset;

  --radius-sm: 12px;
  --radius-md: 16px;
  --radius-lg: 18px;

  --gap-xs: 6px;
  --gap-sm: 10px;
  --gap-md: 14px;
  --gap-lg: 18px;

  --accent: #6d7dff;
  --accent-2: #a78bfa;
  --focus: rgba(109,125,255,.32);

  --glass: rgba(255,255,255,.06);
  --glass-2: rgba(255,255,255,.08);

  /* ===== Legacy aliases mapped to new system ===== */
  --bg: var(--surface-0);
  --text: var(--text-1);
  --muted: var(--text-2);

  --card-bg: color-mix(in srgb, var(--surface-2) 92%, transparent);
  --card-brd: var(--border-2);
  --input-bg: color-mix(in srgb, var(--surface-2) 88%, transparent);
  --shadow: var(--shadow-1);

  /* вспомогательные */
  --shadow-clr: #000;           /* для color-mix в модулях */
  --glass-brd: var(--border-1); /* единый бордер для “glass” */

  --primary-start: var(--accent);
  --primary-end:   var(--accent-2);

  --bg-gradient: linear-gradient(180deg, #0a0f18 0%, #0c1220 100%);
  --bg-radial-1: radial-gradient(1200px 700px at 8% -12%, rgba(120, 140, 255, 0.2) 0%, transparent 60%);
  --bg-radial-2: radial-gradient(900px 520px at 110% 12%, rgba(167, 139, 250, 0.16) 0%, transparent 60%);

  --blob-1: var(--accent);
  --blob-2: var(--accent-2);

  --sidebar-bg: var(--surface-1);
  --sidebar-brd: rgba(255,255,255,.08);
  --sidebar-text: var(--text-1);
  --sidebar-hover: rgba(255,255,255,.06);
  --sidebar-active: rgba(109,125,255,.1);

  --topbar-bg: var(--surface-2);
  --topbar-brd: rgba(255,255,255,.1);
  --topbar-text: var(--text-1);
  --topbar-input-bg: color-mix(in srgb, var(--surface-2) 92%, transparent);

  /* ========= TYPOGRAPHY ========= */
  --font-base: 16px;
  --font-multiplier: 1;

  /* шкала (как в sidebar) */
  --fs-2xs: calc(0.6875rem * var(--font-multiplier)); /* 11px */
  --fs-xs:  calc(0.75rem * var(--font-multiplier));   /* 12px */
  --fs-sm:  calc(0.875rem * var(--font-multiplier));  /* 14px */
  --fs-md:  calc(1rem * var(--font-multiplier));      /* 16px */
  --fs-lg:  calc(1.125rem * var(--font-multiplier));  /* 18px */
  --fs-xl:  calc(1.25rem * var(--font-multiplier));   /* 20px */
  --fs-2xl: calc(1.375rem * var(--font-multiplier));  /* 22px */
  --fs-3xl: calc(1.75rem * var(--font-multiplier));   /* 28px */

  --lh-tight: 1.1;
  --lh-normal: 1.4;
  --lh-comfy: 1.6;

  --fw-regular: 400;
  --fw-medium:  600;
  --fw-bold:    800;

  /* ========= SPACING ========= */
  --space-1: 0.25rem; /* 4px */
  --space-2: 0.5rem;  /* 8px */
  --space-3: 0.75rem; /* 12px */
  --space-4: 1rem;    /* 16px */
  --space-5: 1.25rem; /* 20px */
  --space-6: 1.5rem;  /* 24px */

  /* ========= RADII ========= */
  --radius-sm: 12px;
  --radius-md: 16px;
  --radius-lg: 18px;
  --radius-xl: 20px;
  --radius-full: 999px;

  /* ========= ELEVATION ========= */
  --elev-1: var(--shadow-1);
  --elev-2: 0 24px 70px rgba(0,0,0,.45);
  --elev-3: 0 32px 90px rgba(0,0,0,.5);

  /* ========= SIZES / LAYOUT ========= */
  --sidebar-w: 15.5rem;           /* 248px */
  --sidebar-w-collapsed: 4.75rem; /* 76px */
  --topbar-h: 5rem;               /* 64px */
  --icon-box: 40px;

  /* ========= ANIMATION ========= */
  --tr-fast: .15s ease;
  --tr-med:  .22s ease;

  /* управляется ThemeProvider */
  --font-scale: 100;
  --glass-blur: 26px;
  --glass-sat: 140%;

  --success:        #65f797;
  --success-weak:   color-mix(in srgb, var(--success) 18%, transparent);

  --danger:         #ff665a;
  --danger-weak:    color-mix(in srgb, var(--danger) 18%, transparent);

  --switch-track:   color-mix(in srgb, var(--card-bg) 80%, #0000);
  --switch-knob:    #ffffff;

  --deal-green-h: 120;
  --deal-green-s: 60%;
  --deal-light-start: 50%;
  --deal-light-end: 20%;

  /* ===== CALENDAR TOKENS (dark) ===== */
  --cal-accent: #7a5bff;
  --cal-accent-soft: color-mix(in srgb, #7a5bff 16%, transparent);
  --cal-accent-line: color-mix(in srgb, #7a5bff 80%, transparent);

  --cal-today-bg: rgba(122, 91, 255, 1);
  --cal-today-text: #000;

  --cal-event-violet-bg: rgba(154, 86, 255, .25);
  --cal-event-violet-brd: rgba(154, 86, 255, .55);
  --cal-event-red-bg: rgba(255, 91, 76, .25);
  --cal-event-red-brd: rgba(255, 91, 76, .6);

  --cal-now-line: var(--cal-accent-line);
  --cal-now-badge-bg: #000;
  --cal-now-badge-brd: rgba(122, 91, 255, .5);


  --editor-bg:    var(--card-bg);
  --editor-text:  var(--text);
  --editor-link:  color-mix(in srgb, var(--primary-start) 85%, var(--primary-end) 15%);
  --editor-border: var(--card-brd);
  --editor-surface: color-mix(in srgb, var(--card-bg) 88%, transparent);
}

/* LIGHT */
:root[data-theme="light"] {
  --bg: #fdfcf9;
  --text: #2e2e35;
  --muted: #777b85;

  --card-bg: rgba(255, 255, 255, .85);
  --card-brd: rgba(30, 30, 40, .08);
  --input-bg: rgba(255, 255, 255, .95);

  --shadow: 0 16px 40px rgba(180, 150, 120, .15);

  --primary-start: #ff8c5c;
  --primary-end:   #a77bff;
  --accent: var(--primary-start);
  --accent-2: var(--primary-end);
  --focus: #ffb685;
  --glass: rgba(0,0,0,.04);
  --glass-2: rgba(0,0,0,.06);

  --bg-gradient: linear-gradient(160deg, #fff8f2 0%, #f9f4ff 100%);
  --bg-radial-1: radial-gradient(1200px 600px at 10% -10%, #ffe1c4 0%, transparent 60%);
  --bg-radial-2: radial-gradient(800px 400px at 110% 10%, #e3d2ff 0%, transparent 60%);

  --sidebar-bg: rgba(255, 255, 255, .82);
  --sidebar-brd: rgba(30, 30, 40, .08);
  --sidebar-text: #2e2e35;
  --sidebar-hover: rgba(255, 154, 115, .10);
  --sidebar-active: rgba(255, 154, 115, .18);

  --topbar-bg: rgba(255, 255, 255, .9);
  --topbar-brd: rgba(30, 30, 40, .08);
  --topbar-text: #2e2e35;
  --topbar-input-bg: rgba(255, 255, 255, .96);

  --glass-blur: 4px;

  --success:        #2ecc71;
  --success-weak:   color-mix(in srgb, var(--success) 18%, transparent);

  --danger:         #ff4d4f;
  --danger-weak:    color-mix(in srgb, var(--danger) 18%, transparent);

  --switch-track:   color-mix(in srgb, #000 6%, #fff);
  --switch-knob:    #ffffff;

  /* ===== CALENDAR TOKENS (light) ===== */
  --cal-accent: #ff8c5c;
  --cal-accent-soft: color-mix(in srgb, #ff8c5c 16%, transparent);
  --cal-accent-line: color-mix(in srgb, #ff8c5c 80%, transparent);

  --cal-today-bg: rgba(255, 140, 92, 1);
  --cal-today-text: #fff;

  --cal-event-violet-bg: rgba(167, 123, 255, .28);
  --cal-event-violet-brd: rgba(167, 123, 255, .5);
  --cal-event-red-bg: rgba(255, 122, 122, .22);
  --cal-event-red-brd: rgba(255, 122, 122, .45);

  --cal-now-line: var(--cal-accent-line);
  --cal-now-badge-bg: #fff;
  --cal-now-badge-brd: rgba(255, 140, 92, .4);

  --editor-bg:    var(--card-bg);
  --editor-text:  var(--text);
  --editor-link:  color-mix(in srgb, var(--primary-start) 85%, var(--primary-end) 15%);
  --editor-border: var(--card-brd);
  --editor-surface: color-mix(in srgb, var(--card-bg) 92%, #fff 0%);

}

/* плавная смена темы и остальные утилы остаются как были */
html {
  font-size: var(--font-base);
  transition: background .25s ease, color .25s ease;
}

/* ========= GLOBAL TYPOGRAPHY UTILS ========= */
.u-text      { font-size: var(--fs-md); line-height: var(--lh-normal); }
.u-muted     { color: var(--muted); }
.u-title     { font-size: var(--fs-lg); font-weight: var(--fw-bold); line-height: var(--lh-tight); }
.u-title-sm  { font-size: var(--fs-md); font-weight: var(--fw-bold); line-height: var(--lh-tight); }
.u-caption   { font-size: var(--fs-xs); color: var(--muted); }
.u-kpi       { font-size: var(--fs-2xl); font-weight: var(--fw-bold); line-height: var(--lh-tight); }

.u-btn       { font-size: var(--fs-sm); font-weight: var(--fw-medium); }
.u-input     { font-size: var(--fs-sm); line-height: var(--lh-normal); }

/* === Light override: Pastel Glow === */
:root[data-theme="light"] .inner {
  background: linear-gradient(180deg, #fff7f2 0%, #fff 100%);
  border: 1px solid rgba(255, 170, 130, .25);
  box-shadow:
    0 16px 36px rgba(255, 140, 100, .14),
    inset 0 1px 0 rgba(255, 255, 255, .65);
}

:root[data-theme="light"] .header,
:root[data-theme="light"] .footer {
  background: linear-gradient(180deg, rgba(255, 247, 242, .97) 0%, rgba(255,255,255,.92) 100%);
  border-color: rgba(255,170,130,.25);
}

/* ================= INPUTS ================= */
:root[data-theme="light"] input,
:root[data-theme="light"] select,
:root[data-theme="light"] textarea {
  background: rgba(255,255,255,.96);
  border: 1px solid rgba(200,120,90,.35);
  box-shadow: inset 0 1px 2px rgba(0,0,0,.05);
  transition: border-color .15s, box-shadow .15s;
}

:root[data-theme="light"] input:hover,
:root[data-theme="light"] select:hover,
:root[data-theme="light"] textarea:hover {
  border-color: rgba(255,140,100,.55);
}

:root[data-theme="light"] input:focus,
:root[data-theme="light"] select:focus,
:root[data-theme="light"] textarea:focus {
  border-color: #ff8c64;
  box-shadow: 0 0 0 3px rgba(255,140,100,.25);
  outline: none;
}

:root[data-theme="light"] label {
  color: #7a5b55;
}
